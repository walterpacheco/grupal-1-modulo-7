doctype html
html
  head
    title Productos
    link(rel="stylesheet", href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css")
    link(rel='stylesheet', href='https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css')
    link(rel="stylesheet", href="/styles.css") 
  body
    // Barra de navegación
    nav.navbar.navbar-expand-lg.navbar-dark.bg-dark.d-flex.align-items-center
      .container
        a.navbar-brand(href='/') Ecommerce
        button.navbar-toggler(type='button', data-toggle='collapse', data-target='#navbarNav', aria-controls='navbarNav', aria-expanded='false', aria-label='Toggle navigation')
          span.navbar-toggler-icon
        #navbarNav.collapse.navbar-collapse
          ul.navbar-nav.ml-auto
            // Mostrar el nombre del usuario conectado si está autenticado
            if usuarioAutenticado
              li.nav-item
                span.nav-link.text-white Bienvenido: #{usuarioAutenticado.nombre}

            li.nav-item
              a.nav-link.btn(href='/productos') Productos

            // Mostrar el enlace de Usuarios solo si es admin
            if esAdmin
              li.nav-item
                a.nav-link.btn(href='/usuarios') Usuarios

            // Mostrar el botón de cerrar sesión solo si el usuario está autenticado
            if usuarioAutenticado
              li.nav-item
                form(action='/cerrar-sesion', method='POST', style="display:inline")
                  button.nav-link.btn.btn-danger(type="submit") Cerrar Sesión

    // Contenido principal
    .container.mt-5
      h1.text-center.text-primary.mb-5 Lista de Productos

      // Lista de productos
      .row.justify-content-center
        each producto in productos
          .col-md-3.mb-4.d-flex.align-items-stretch
            .card.shadow-sm.h-100
              img.card-img-top(src=`${producto.imagen}`, alt=producto.nombre, style="object-fit: cover; height: 200px;")
              .card-body.d-flex.flex-column
                h5.card-title #{producto.nombre}
                p.card-text.mb-1
                  strong Categoría:
                  span #{producto.categoria}
                p.card-text.mb-3
                  strong Precio:
                  span #{producto.precio} $
              .card-footer.text-center.mt-auto
                a.btn.btn-info.btn-sm(href=`/productos/${producto.id}`)
                  i.bi.bi-eye-fill Ver Detalles
                // Mostrar el botón de Editar solo si el usuario es admin
                if esAdmin
                  a.btn.btn-warning.btn-sm.ml-2(href=`/productos/${producto.id}/editar`)
                    i.bi.bi-pencil-square Editar
                // Mostrar el botón de Eliminar solo si el usuario es admin
                if esAdmin
                  form(action=`/productos/${producto.id}/eliminar`, method="POST", style="display:inline")
                    button.btn.btn-danger.btn-sm(type="submit" onclick="return confirm('¿Estás seguro de eliminar este producto?')") 
                      i.bi.bi-trash-fill Eliminar

      // Formulario para crear un nuevo producto, solo si es admin
      if esAdmin
        .card.shadow.mt-5
          .card-header.bg-primary.text-white
            h2 Crear un nuevo producto
          .card-body
            form(action="/productos" method="POST" enctype="multipart/form-data" class="mt-3")
              .form-group
                label(for="nombre") Nombre:
                input.form-control(type="text" name="nombre" required)
              .form-group
                label(for="descripcion") Descripción:
                input.form-control(type="text" name="descripcion" required)
              .form-group
                label(for="precio") Precio:
                input.form-control(type="number" step="0.01" name="precio" required)
              .form-group
                label(for="inventario") Inventario:
                input.form-control(type="number" name="inventario" required)
              .form-group
                label(for="categoria") Categoría:
                input.form-control(type="text" name="categoria" required)
              .form-group
                label(for="imagen") Imagen:
                input.form-control(type="file" name="image" accept="image/*")
              button.btn.btn-success.btn-block.mt-3(type="submit")
                i.bi.bi-plus-circle-fill Crear Producto

      // Botón de regreso a inicio
      .row.mt-4.justify-content-center
        .col-md-6
          a(href='/', class='btn btn-secondary btn-lg btn-block') Regresar a Inicio

    script(src="https://code.jquery.com/jquery-3.5.1.slim.min.js")
    script(src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.1/dist/umd/popper.min.js")
    script(src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js")
